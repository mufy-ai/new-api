name: è¿œç¨‹æœåŠ¡å™¨éƒ¨ç½²

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
  push:
    branches: [ prod ]  # å½“æ¨é€åˆ°prodåˆ†æ”¯æ—¶è§¦å‘

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3
      
      - name: è¿æ¥æœåŠ¡å™¨å¹¶æ‰§è¡Œéƒ¨ç½²
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          password: ${{ secrets.SSH_PWD }}
          port: 22
          script: |
            cd /www/wwwroot/chatmindai/go-server/new-api
            bash deploy.sh
            
      - name: å‘é€é£ä¹¦é€šçŸ¥
        id: lark_notification
        uses: foxundermoon/feishu-action@v2
        with:
          url: https://open.larksuite.com/open-apis/bot/v2/hook/d52de161-c9fa-443f-a075-c7d233f101e6
          msg_type: text
          content: |
            âœ… åº”ç”¨å·²æˆåŠŸéƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼
            ğŸ“ æäº¤ä¿¡æ¯: ${{ github.event.head_commit.message }}
            ğŸ”„ è§¦å‘åˆ†æ”¯: ${{ github.ref_name }}
            ğŸ‘¨â€ğŸ’» æäº¤è€…: ${{ github.actor }} 